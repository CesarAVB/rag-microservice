# ===============================
# = PROFILE PRODUCAO
# ===============================
# Este arquivo contem configuracoes otimizadas para producao
# Ativo quando: spring.profiles.active=prod
# IMPORTANTE: Usar variaveis de ambiente para dados sensiveis!

# ===============================
# = SERVER
# ===============================
# Porta (geralmente definida por variavel de ambiente)
server.port=${PORT:8080}

# Compressao de resposta habilitada
server.compression.enabled=true
server.compression.min-response-size=1024

# ===============================
# = LOGGING (Producao - Otimizado)
# ===============================
# Aplicacao - Apenas erros e warnings
logging.level.br.com.cesaravb=WARN

# Spring Security - Apenas erros
logging.level.org.springframework.security=ERROR

# JPA/Hibernate - Desabilitado (impacta performance)
logging.level.org.hibernate.SQL=OFF
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=OFF
logging.level.org.hibernate.engine.jdbc.spi.SqlExceptionHelper=ERROR

# Spring Framework
logging.level.org.springframework=WARN
logging.level.org.springframework.web=ERROR

# Arquivo de log
logging.file.name=logs/rag-microservice.log
logging.file.max-size=10MB
logging.file.max-history=30
logging.pattern.file=%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n

# ===============================
# = DATA SOURCE (Producao)
# ===============================
# URL do banco via variaveis de ambiente (Cloud services)
# Exemplo Heroku: DATABASE_URL=postgres://user:pass@host:5432/db
# Exemplo AWS RDS: Usar PGHOST, PGPORT, PGDATABASE, PGUSER, PGPASSWORD

# PostgreSQL via variaveis de ambiente
spring.datasource.url=jdbc:postgresql://${PGHOST}:${PGPORT}/${PGDATABASE}
spring.datasource.username=${PGUSER}
spring.datasource.password=${PGPASSWORD}
spring.datasource.driver-class-name=org.postgresql.Driver

# Pool de conexoes otimizado para producao
spring.datasource.hikari.maximum-pool-size=20
spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.max-lifetime=1800000
spring.datasource.hikari.auto-commit=true

# ===============================
# = JPA / HIBERNATE
# ===============================
# 'validate' - apenas valida schema, NAO cria/atualiza tabelas
# Migrations devem ser feitas com Flyway antes
spring.jpa.hibernate.ddl-auto=validate

# Nao mostra SQL (impacta performance)
spring.jpa.show-sql=false

# Nao formata SQL (economia de CPU)
spring.jpa.properties.hibernate.format_sql=false

# Dialeto PostgreSQL
spring.jpa.database-platform=org.hibernate.dialect.PostgreSQLDialect

# Otimizacoes de performance
spring.jpa.properties.hibernate.jdbc.fetch_size=50
spring.jpa.properties.hibernate.jdbc.batch_size=20
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true

# Desabilita reflexao desnecessaria
spring.jpa.properties.hibernate.boot.allow_jdbc_metadata_access=false

# ===============================
# = FLYWAY (Habilitado em Producao)
# ===============================
# Flyway roda automaticamente no startup para versionamento de BD
spring.flyway.enabled=true

# Nao usa placeholders (pode ter seguranca)
spring.flyway.placeholder-replacement=false

# Importante: desabilita clean em producao!
spring.flyway.clean-disabled=true

# ===============================
# = REDIS (Producao)
# ===============================
# Redis em producao (Cloud hosted)
# Exemplo: REDIS_URL=redis://username:password@host:port/db
spring.data.redis.url=${REDIS_URL:redis://localhost:6379/0}

# Timeout para conexao
spring.data.redis.timeout=2000ms

# Configuracao alternativa (se nao usar REDIS_URL)
# spring.data.redis.host=${REDIS_HOST}
# spring.data.redis.port=${REDIS_PORT:6379}
# spring.data.redis.password=${REDIS_PASSWORD}
# spring.data.redis.database=${REDIS_DATABASE:0}

# ===============================
# = SWAGGER/OPENAPI (Desabilitado)
# ===============================
# Swagger desabilitado em producao (seguranca + performance)
springdoc.api-docs.enabled=false
springdoc.swagger-ui.enabled=false

# ===============================
# = OPENROUTER API (Producao)
# ===============================
# API Key via variavel de ambiente (nunca hardcoded!)
openrouter.api-key=${OPENROUTER_API_KEY}
openrouter.base-url=https://openrouter.ai/api/v1
openrouter.model=mistral-7b-instruct

# Timeout padr�o (nao muito alto para respostas rapidas)
openrouter.timeout-seconds=60

# ===============================
# = ACTUATOR (Producao - Restrito)
# ===============================
# Apenas endpoints essenciais expostos
management.endpoints.web.exposure.include=health,info,metrics
management.endpoint.health.show-details=when-authorized

# Actuator port separado (seguran�a)
management.server.port=9090
management.server.address=127.0.0.1

# ===============================
# = CACHE (Habilitado em Producao)
# ===============================
# Cache habilitado para performance
spring.cache.type=redis

# TTL padrao de cache
spring.cache.redis.time-to-live=3600000

# ===============================
# = JACKSON (Producao)
# ===============================
# Sem indentacao (economia de banda)
spring.jackson.serialization.indent-output=false

# ===============================
# = FILE UPLOAD
# ===============================
# Diret�rio em producao (pode ser volume no Docker)
upload.dir=${UPLOAD_DIR:/app/uploads}

# ===============================
# = DEVTOOLS (Desabilitado)
# ===============================
# DevTools nunca em producao
spring.devtools.restart.enabled=false

# ===============================
# = SESSIONS
# ===============================
# Session timeout (30 minutos)
server.servlet.session.timeout=30m

# ===============================
# = SSL/TLS (Se usar HTTPS)
# ===============================
# Certificado SSL
# server.ssl.key-store=${SSL_KEYSTORE_PATH}
# server.ssl.key-store-password=${SSL_KEYSTORE_PASSWORD}
# server.ssl.key-store-type=PKCS12

# ===============================
# = ENCODING
# ===============================
spring.application.encoding=UTF-8
server.servlet.encoding.charset=UTF-8

# ===============================
# = VARIAVEIS DE AMBIENTE NECESSARIAS
# ===============================
# Antes de rodar em producao, certifique-se de ter:
#
# SPRING_PROFILES_ACTIVE=prod
# PGHOST=seu-postgres-host
# PGPORT=5432
# PGDATABASE=rag_db
# PGUSER=usuario
# PGPASSWORD=senha-segura
# REDIS_URL=redis://host:6379
# OPENROUTER_API_KEY=sua-api-key
# PORT=8080 (Heroku/Cloud define automaticamente)
#
# Exemplo com Docker:
# docker run -e SPRING_PROFILES_ACTIVE=prod \
#            -e PGHOST=postgres \
#            -e PGPORT=5432 \
#            -e PGDATABASE=rag_db \
#            -e PGUSER=postgres \
#            -e PGPASSWORD=senha \
#            -e REDIS_URL=redis://redis:6379 \
#            -e OPENROUTER_API_KEY=key \
#            seu-usuario/rag-microservice:1.0.0